jQuery.fn.populate=function(obj,options){function parseJSON(obj,path){if(path=path||"",void 0==obj);else if(obj.constructor==Object)for(var prop in obj){var name=path+(""==path?prop:"["+prop+"]");parseJSON(obj[prop],name)}else if(obj.constructor==Array)for(var i=0;i<obj.length;i++){var index=options.useIndices?i:"";index=options.phpNaming?"["+index+"]":index;var name=path+index;parseJSON(obj[i],name)}else void 0==arr[path]?arr[path]=obj:arr[path].constructor!=Array?arr[path]=[arr[path],obj]:arr[path].push(obj)}function debug(str){window.console&&console.log&&console.log(str)}function getElementName(name){return options.phpNaming||(name=name.replace(/\[\]$/,"")),name}function populateElement(parentElement,name,value){var selector="id"==options.identifier?"#"+name:"["+options.identifier+'="'+name+'"]',element=jQuery(selector,parentElement);value=value.toString(),value="null"==value?"":value,element.html(value)}function populateFormElement(form,name,value){var name=getElementName(name),element=form[name];if(void 0==element)return(element=jQuery("#"+name,form))?(element.html(value),!0):(options.debug&&debug("No such element as "+name),!1);options.debug&&_populate.elements.push(element),elements=void 0==element.type&&element.length?element:[element];for(var e=0;e<elements.length;e++){var element=elements[e];if(element&&"undefined"!=typeof element&&"function"!=typeof element)switch(element.type||element.tagName){case"radio":element.checked=""!=element.value&&value.toString()==element.value;case"checkbox":for(var values=value.constructor==Array?value:[value],j=0;j<values.length;j++)element.checked|=element.value==values[j];break;case"select-multiple":for(var values=value.constructor==Array?value:[value],i=0;i<element.options.length;i++)for(var j=0;j<values.length;j++)element.options[i].selected|=element.options[i].value==values[j];break;case"select":case"select-one":element.value=value.toString()||value;break;case"text":case"button":case"textarea":case"submit":default:value=null==value?"":value,element.value=value}}}if(void 0===obj)return this;var options=jQuery.extend({phpNaming:!0,phpIndices:!1,resetForm:!0,identifier:"id",debug:!1},options);options.phpIndices&&(options.phpNaming=!0);var arr=[];return parseJSON(obj),options.debug&&(_populate={arr:arr,obj:obj,elements:[]}),this.each(function(){var tagName=this.tagName.toLowerCase(),method="form"==tagName?populateFormElement:populateElement;"form"==tagName&&options.resetForm&&this.reset();for(var i in arr)method(this,i,arr[i])}),this};var IBoxForm=function(iBox,selector){this.layback({element:selector,box:iBox})};!function($,IBoxForm){var lb=layback(IBoxForm).use("setget").make();lb.addMethod("form",function(){return this.getBox().$(this.get("element"))}),lb.addMethod("getFormElement",function(selector){return $(selector,this.form())}),lb.addMethod("populate",function(){return this.form().populate.apply(this.form(),Array.prototype.slice.call(arguments))})}(jQuery,IBoxForm);var IBox=function(options){this.layback(options),this.create()},IBox_Defaults=IBox_Defaults||{};!function($,IBox,IBox_Defaults){IBox._iframeCounter=0,lb=layback(IBox).defaults({data:$.extend({baseUrl:"test/sandboxes",pageUrl:null,iframeId:null,iframe:null,document:null,window:null},IBox_Defaults)}).use("setget").make(),lb.addClassMethod("getNextIframeId",function(iframeId){return"iboxIframe"+IBox._iframeCounter++}),lb.addMethod("destroy",function(){var iframe=this.getIframe();return iframe&&iframe.remove(),this}),lb.addMethod("create",function(iframeId){this.destroy(),this.setIframeId(iframeId||this.getIframeId()||IBox.getNextIframeId()),this.dispatch("create-before"),iframeId=this.getIframeId();var iframe=$('<iframe id="'+iframeId+'"></iframe>');return iframe.appendTo($("body")),this.setIframe(iframe),this.dispatch("create-after"),this}),lb.addMethod("createPageUrl",function(page){return 0===page.indexOf("http://")||0===page.indexOf("https://")||0===page.indexOf("//")?page:this.getBaseUrl()+"/"+page}),lb.addMethod("visitPage",function(page,done){var This=this;return this.setPageUrl(this.createPageUrl(page)),this.dispatch("page-visit-before"),this.getIframe().attr("src",this.getPageUrl()),this.getIframe().load(function(){This.setDocument(this.contentDocument),This.setWindow(this.contentWindow),setTimeout(function(){done&&done(),This.dispatch("page-visit-after")},1e3)}),this}),lb.addMethod("isOnPage",function(page){return this.getIframe().attr("src")==this.createPageUrl(page)}),lb.addMethod("document",function(page,done){return this.getDocument()}),lb.addMethod("window",function(page,done){return this.getWindow()}),lb.addMethod("$",function(selector){return $(selector,this.document())}),lb.addMethod("getVar",function(varname){return this.window()[varname]}),lb.addMethod("getForm",function(selector){return new IBoxForm(this,selector)})}(jQuery,IBox,IBox_Defaults);